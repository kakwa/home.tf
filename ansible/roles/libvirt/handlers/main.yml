---
# Handlers for libvirt operations

- name: restart libvirtd
  systemd:
    name: libvirtd
    state: restarted

- name: reload libvirtd
  systemd:
    name: libvirtd
    state: reloaded

- name: reload kvm modules
  shell: |
    modprobe -r kvm_intel 2>/dev/null || true
    modprobe -r kvm_amd 2>/dev/null || true
    modprobe -r kvm 2>/dev/null || true
    modprobe kvm 2>/dev/null || true
    modprobe kvm_intel 2>/dev/null || true
    modprobe kvm_amd 2>/dev/null || true
  changed_when: false
  failed_when: false

- name: restart default network
  shell: |
    virsh net-destroy default || true
    virsh net-start default || true
  changed_when: false
  failed_when: false

