# nslcd.conf - NSS/PAM LDAP client (managed by Ansible)
# Users/groups from {{ ssh_ldap_uri }}, base {{ ssh_ldap_base_dn }}

uid nslcd
gid nslcd

log {{ ssh_ldap_nslcd_log | default('syslog debug') }}

uri {{ ssh_ldap_uri }}
base {{ ssh_ldap_base_dn }}

binddn {{ ssh_ldap_bind_dn }}
bindpw {{ ssh_ldap_bind_password }}

# TLS
tls_reqcert {{ ssh_ldap_tls_reqcert }}

# Search base per map (global base above used if not set)
base passwd {{ ssh_ldap_user_ou }}
base group {{ ssh_ldap_group_ou }}
base shadow {{ ssh_ldap_user_ou }}

# Scope: onelevel = immediate children only (users/groups directly under the OU)
scope passwd onelevel
scope group onelevel
scope shadow onelevel

# Search filters (defaults are objectClass=posixAccount / posixGroup)
filter passwd (objectClass=posixAccount)
filter group (objectClass=posixGroup)
filter shadow (objectClass=posixAccount)

# RFC 2307 attribute mapping (passwd: posixAccount; group: posixGroup)
# passwd: uid, uidNumber, gidNumber, gecos (cn), homeDirectory, loginShell; userPassword masked by default
map    passwd gecos           cn
# group: member (DN) kept as member; memberUid mapped to member
map    group  memberUid       member

# Scope: onelevel = immediate children only (users/groups directly under the OU)
scope passwd onelevel
scope group onelevel
scope shadow onelevel

# Search filters (defaults are objectClass=posixAccount / posixGroup)
filter passwd (objectClass=posixAccount)
filter group (objectClass=posixGroup)
filter shadow (objectClass=posixAccount)
